<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Heat Wave Health – Membership</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Stripe -->
  <script src="https://js.stripe.com/v3/"></script>

  <!-- Montserrat (body font) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap"
    rel="stylesheet"
  >

  <style>
    /* ===== Custom fonts – paths match your uploaded files ===== */
    @font-face {
      font-family: "Beautique Display";
      src: url("/Beautique Display/BeautiqueDisplay-Regular.otf") format("opentype");
      font-weight: normal;
      font-style: normal;
    }
    @font-face {
      font-family: "Omnes Pro";
      src: url("/omnes-2/Omnes Regular.ttf") format("truetype");
      font-weight: normal;
      font-style: normal;
    }

    :root {
      --hw-bg: #F1ECE1;
      --hw-card: #EEE3D2;
      --hw-accent: #964605;
      --hw-accent-dark: #2A1D09;
      --hw-text: #000000;
      --hw-border: rgba(0, 0, 0, 0.15);
      --hw-radius-xl: 18px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: var(--hw-bg);
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--hw-text);
      letter-spacing: 0.01em;
    }

    .shell {
      width: 100%;
      max-width: 920px;
      padding: 24px;
    }

    .card {
      background-color: var(--hw-card);
      border-radius: var(--hw-radius-xl);
      border: 1px solid var(--hw-border);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.06);
      padding: 28px 22px 30px;
    }

    @media (min-width: 768px) {
      .card { padding: 34px 40px 36px; }
    }

    /* Header */
    .header { margin-bottom: 34px; }

    /* Wordmark (previously increased +10% more now) */
    .hero-logo {
      display: block;
      margin: 0 auto 14px;
      width: 64%;
      max-width: 505px;
      height: auto;
    }
    @media (min-width: 900px) {
      .hero-logo {
        width: 68%;
        max-width: 560px;
      }
    }

    /* Indented, left-aligned, not lining up with cards */
    .subtitle-wrap {
      padding-left: 14px;
      padding-right: 14px;
    }
    @media (min-width: 768px) {
      .subtitle-wrap {
        padding-left: 24px;
        padding-right: 24px;
      }
    }

    .subtitle {
      font-size: 0.98rem;
      line-height: 1.65;
      margin: 0;
      max-width: 46rem;
      text-align: left;
    }

    .divider {
      height: 1px;
      background: var(--hw-border);
      margin: 22px 0;
    }

    .section { margin-top: 18px; }

    .section-title {
      font-family: "Beautique Display", serif;
      font-size: 0.9rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin: 0 0 10px;
      color: var(--hw-text);
    }

    .option-group {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 820px) {
      .option-group {
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }
    }

    .option-row {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      border-radius: 14px;
      border: 1px solid var(--hw-border);
      background: rgba(241, 236, 225, 0.7);
      transition: border-color 0.15s ease, background-color 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
      cursor: pointer;
    }

    .option-row:hover {
      border-color: var(--hw-accent);
      background: #f7efe3;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.04);
      transform: translateY(-1px);
    }

    .option-row input[type="radio"] {
      accent-color: var(--hw-accent);
      margin-top: 2px;
      flex-shrink: 0;
      transform: scale(1.05);
    }

    /* Membership cards: bigger + more premium weight */
    .option-row.big { padding: 15px 16px; }
    .option-row.big .option-label-main {
      font-size: 1.02rem;
      font-weight: 600;
      line-height: 1.2;
    }
    .option-row.big .option-label-sub {
      font-size: 0.86rem;
      line-height: 1.55;
      margin-top: 5px;
      opacity: 0.92;
    }
    .option-row.big .price-line {
      font-size: 0.90rem;
      font-weight: 600;
      margin-top: 8px;
    }

    /* Billing cards: slightly smaller */
    .option-row.compact { padding: 11px 14px; }
    .option-row.compact .option-label-main {
      font-size: 0.95rem;
      font-weight: 600;
      line-height: 1.2;
    }
    .option-row.compact .option-label-sub {
      font-size: 0.82rem;
      line-height: 1.5;
      margin-top: 4px;
      opacity: 0.92;
    }

    /* Optional programs pill (now under Billing, centered, with breathing room) */
    .addon-callout-wrap {
      margin-top: 18px;
      margin-bottom: 18px;
      text-align: center;
    }

    .addon-callout {
      display: inline-block;
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid var(--hw-border);
      background: rgba(241, 236, 225, 0.55);
    }

    .note {
      font-size: 0.82rem;
      line-height: 1.55;
      margin: 10px 0 0;
      opacity: 0.92;
    }

    /* Agreement + State inline */
    .agreement-row { margin-top: 10px; font-size: 0.82rem; }

    .agreement-flex {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--hw-border);
      background: rgba(241, 236, 225, 0.7);
    }

    @media (min-width: 640px) {
      .agreement-flex {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
      }
    }

    .agreement-label {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin: 0;
      flex: 1;
      min-width: 240px;
    }

    .agreement-label input[type="checkbox"] {
      margin-top: 2px;
      accent-color: var(--hw-accent);
      flex-shrink: 0;
    }

    .agreement-label a {
      text-decoration: underline;
      text-underline-offset: 2px;
      color: var(--hw-text);
    }
    .agreement-label a:hover { text-decoration-thickness: 2px; }

    .state-inline {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .state-inline label {
      font-size: 0.82rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .state-inline select {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,0.22);
      background: #fff;
      font-family: "Montserrat", sans-serif;
      font-size: 0.9rem;
      min-width: 190px;
    }

    /* Centered eligibility statement */
    .eligibility-center {
      margin-top: 14px;
      text-align: center;
    }

    /* CTA: centered, moved down more */
    .cta-area {
      margin-top: 30px; /* more space so it doesn't feel cramped */
      text-align: center;
    }

    button.primary-btn {
      padding: 9px 22px;
      border-radius: 999px;
      border: none;
      background: var(--hw-accent);
      color: #F1ECE1;
      font-family: "Omnes Pro", "Montserrat", sans-serif;
      font-size: 0.82rem;
      font-weight: 500;
      letter-spacing: 0.07em;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: 0 5px 14px rgba(150, 70, 5, 0.25);
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
      white-space: nowrap;
    }

    button.primary-btn:hover {
      background: var(--hw-accent-dark);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(150, 70, 5, 0.45);
    }

    button.primary-btn:active {
      transform: translateY(0);
      box-shadow: 0 5px 14px rgba(150, 70, 5, 0.35);
    }

    .secure-text {
      margin-top: 10px;
      font-size: 0.78rem;
      opacity: 0.95;
      line-height: 1.4;
    }

    #error-message {
      font-size: 0.84rem;
      color: #b00020;
      margin-top: 10px;
      min-height: 1.2em;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="shell">
    <div class="card">

      <div class="header">
        <img src="/hw-wordmark.svg" alt="Heat Wave Health" class="hero-logo">

        <div class="subtitle-wrap">
          <p class="subtitle">
            You’re about to make a powerful choice for yourself — the kind that changes how you feel in your body,
            your energy, and your confidence. This is you deciding you matter. We’re honored to care for you as you
            come back home to yourself.
          </p>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Choose your membership</div>

        <div class="option-group">
          <label class="option-row big">
            <input type="radio" name="plan" value="essence" checked />
            <div>
              <div class="option-label-main">Essence</div>
              <div class="option-label-sub">
                Core membership with clinician-led care, secure messaging, and ongoing guidance.
              </div>
              <div class="price-line">$170 / month · $1,800 / year</div>
            </div>
          </label>

          <label class="option-row big">
            <input type="radio" name="plan" value="radiance" />
            <div>
              <div class="option-label-main">Radiance</div>
              <div class="option-label-sub">
                Expanded clinical access and priority support for a more proactive care experience.
              </div>
              <div class="price-line">$295 / month · $3,150 / year</div>
            </div>
          </label>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Billing preference</div>

        <div class="option-group">
          <label class="option-row compact">
            <input type="radio" name="billing" value="monthly" checked />
            <div>
              <div class="option-label-main">Monthly</div>
              <div class="option-label-sub">Billed every month. Cancellation requests are reviewed by the clinic.</div>
            </div>
          </label>

          <label class="option-row compact">
            <input type="radio" name="billing" value="annual" />
            <div>
              <div class="option-label-main">Annual</div>
              <div class="option-label-sub">One payment for the year, with savings built in.</div>
            </div>
          </label>
        </div>

        <div class="addon-callout-wrap">
          <span class="addon-callout">Optional monthly programs available after enrollment</span>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section">
        <div class="section-title">Agreement & location</div>

        <div class="agreement-row">
          <div class="agreement-flex">
            <label class="agreement-label">
              <input type="checkbox" id="agreement-checkbox">
              <span>
                By continuing, I confirm I have read and agree to the
                <a href="https://heatwavehealth.com/membership-agreement" target="_blank" rel="noopener noreferrer">
                  Heat Wave Health Membership Agreement
                </a>.
              </span>
            </label>

            <div class="state-inline">
              <label for="service-state">My state:</label>
              <select id="service-state">
                <option value="">Select…</option>
                <option value="WA">Washington (WA)</option>
                <option value="OR">Oregon (OR)</option>
              </select>
            </div>
          </div>

          <div class="eligibility-center">
            <p class="note" style="margin:0;">
              Heat Wave Health currently provides care to members physically located in Washington and Oregon.
            </p>
          </div>

          <div class="cta-area">
            <button id="checkout-button" class="primary-btn">
              Continue to secure payment
            </button>
            <div class="secure-text">
              Processed by Stripe. Your card details never touch our servers.
            </div>
            <p id="error-message"></p>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    let stripe;

    async function initStripe() {
      const res = await fetch("/api/config");
      const data = await res.json();
      if (!data.publishableKey) throw new Error("Missing publishable key");
      stripe = Stripe(data.publishableKey);
    }

    initStripe().catch((e) => {
      console.error(e);
      const errorEl = document.getElementById("error-message");
      if (errorEl) errorEl.textContent = "Payment setup error. Please contact the clinic.";
    });

    document.getElementById('checkout-button').addEventListener('click', async () => {
      const planEl = document.querySelector('input[name="plan"]:checked');
      const billingEl = document.querySelector('input[name="billing"]:checked');
      const agreementCheckbox = document.getElementById('agreement-checkbox');
      const stateSelect = document.getElementById('service-state');
      const errorEl = document.getElementById('error-message');

      errorEl.textContent = '';

      if (!stripe) {
        errorEl.textContent = "Payment is still loading. Please try again in a moment.";
        return;
      }

      if (!agreementCheckbox?.checked) {
        errorEl.textContent = "You must agree to the Membership Agreement before continuing.";
        return;
      }

      const service_state = (stateSelect?.value || '').trim();
      if (!service_state) {
        errorEl.textContent = "Please select WA or OR before continuing.";
        return;
      }

      const plan = planEl ? planEl.value : null;
      const billing = billingEl ? billingEl.value : null;

      if (!plan || !billing) {
        errorEl.textContent = "Please select a membership and billing option.";
        return;
      }

      try {
        const response = await fetch('/api/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ plan, billing, service_state })
        });

        const data = await response.json();
        if (!response.ok || data.error) throw new Error(data.error || 'Server error');

        const result = await stripe.redirectToCheckout({ sessionId: data.id });
        if (result.error) errorEl.textContent = result.error.message;

      } catch (err) {
        console.error(err);
        errorEl.textContent = "Payment could not be started. Please contact the clinic.";
      }
    });
  </script>
</body>
</html>
